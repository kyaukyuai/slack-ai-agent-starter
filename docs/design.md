# URL to Twitter Agent 設計書

## 要件定義書

### 目的
指定されたURLの内容をスクレイピングし、その内容に関する深い調査を行い、結果をTwitterに投稿するエージェントを開発する。

### 機能要件
1. URLからウェブページの内容をスクレイピングする
2. スクレイピングした内容を元に深い調査を行う
3. 調査結果をTwitter投稿用に適切にまとめる
4. まとめた内容をTwitterに投稿する

### 非機能要件
1. エラーハンドリング: 各ステップでのエラーを適切に処理する
2. ログ記録: 処理の各ステップを適切にログに記録する
3. 認証管理: Twitter APIの認証情報を安全に管理する

## 設計書

### 概略設計
URLからTwitterへの投稿を行うエージェントは、以下の5つの主要なステップで構成される：

1. **URL抽出**: 会話からURLを抽出する
2. **URLスクレイピング**: FirecrawlAPIを使用してURLの内容をスクレイピングする
3. **深い調査**: スクレイピングした内容を元に、deep_research機能を使用して周辺知識の理解と思考を深める
4. **投稿内容作成**: 調査結果をTwitter投稿用に適切にまとめる
5. **Twitter投稿**: まとめた内容をTwitterに投稿する

### 機能設計

#### URL抽出機能
- 会話からURLを抽出する
- 正規表現を使用してURLを検出する

#### URLスクレイピング機能
- `firecrawl_scrape`関数を使用してURLの内容をスクレイピングする
- スクレイピング結果をMarkdown形式で取得する

#### 深い調査機能
- `deep_research`関数を使用してスクレイピングした内容に関する深い調査を行う
- 調査結果を構造化された形式で取得する

#### 投稿内容作成機能
- スクレイピング結果と調査結果を元に、Twitter投稿用の内容を生成する
- 投稿内容は280文字以内に収める
- 重要なポイントを簡潔にまとめる

#### Twitter投稿機能
- Twitter APIを使用してTwitterに投稿する
- 認証情報の管理と認証プロセスを処理する

#### エラーハンドリング機能
- 各ステップでのエラーを検出し、適切なエラーメッセージを生成する
- エラーが発生した場合、処理を中断し、エラーメッセージを会話に追加する

### エージェント構成

#### URLToTwitterState
- URLからTwitterへの投稿を行うエージェントの状態を定義するクラス
- 属性:
  - `messages`: 会話の履歴
  - `url`: スクレイピングするURL
  - `user_id`: Twitter認証用のユーザーID
  - `scraped_content`: スクレイピングした内容
  - `scraped_data`: スクレイピング結果の生データ
  - `research_result`: 調査結果
  - `tweet_content`: 投稿内容
  - `tweet_result`: 投稿結果
  - `error`: エラーメッセージ

#### URLToTwitterAgent
- URLからTwitterへの投稿を行うエージェントクラス
- LangGraphを使用したステートグラフで構成
- ノード:
  - `extract_url`: 会話からURLを抽出するノード
  - `scrape_url`: URLをスクレイピングするノード
  - `research_content`: スクレイピングした内容を調査するノード
  - `create_tweet`: 投稿内容を作成するノード
  - `post_tweet`: Twitterに投稿するノード
  - `add_error_message`: エラーメッセージを会話に追加するノード
  - `add_result_message`: 処理結果を会話に追加するノード
- 条件付きエッジ:
  - 各ノードの処理結果に応じて、次のノードを決定する
  - エラーが発生した場合は、`add_error_message`ノードに遷移する
  - 処理が成功した場合は、次のノードに遷移する
